<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteio com Login</title>
    <link rel="stylesheet" href="styles.css"> <!-- Vincula o arquivo CSS -->
</head>
<body>
    <div id="loginPage">
        <h2>Login</h2>
        <input type="password" id="password" placeholder="Digite a senha" />
        <button onclick="login()">Entrar</button>
        <p id="error" style="color: red; display: none;">Senha incorreta</p>
    </div>

    <div id="mainPage" class="hidden">
        <h2>Sorteio</h2>
        <button onclick="mostrarAdicionarParticipante()">Adicionar Participante</button> <!-- Botão para adicionar participante -->
        <button onclick="limparHistorico()">Limpar Histórico</button> <!-- Botão para limpar histórico -->
        <br><br>
        <button onclick="sortear()">Sortear</button>
        <h3>Ganhador:</h3>
        <p id="ganhador" class="winner"></p>
        <h3>Participantes:</h3>
        <ul id="participantesList"></ul>
        <h3>Histórico de Ganhadores:</h3>
        <ul id="historico"></ul>

        <!-- Aba flutuante para adicionar participante -->
        <div id="adicionarParticipanteModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharAdicionarParticipante()">&times;</span>
                <h3>Adicionar Participante</h3>
                <input type="text" id="nome" placeholder="Digite o nome" />
                <button onclick="adicionarNome()">Adicionar</button>
            </div>
        </div>

        <!-- Modal para confirmação de senha ao limpar o histórico -->
        <div id="confirmarLimpezaModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharConfirmarLimpeza()">&times;</span>
                <h3>Confirmar Limpeza de Histórico</h3>
                <input type="password" id="senhaLimpeza" placeholder="Digite a senha para confirmar" />
                <button onclick="confirmarLimpeza()">Limpar Histórico</button>
            </div>
        </div>
    </div>

    <script>
        const senhaCorreta = 'senha123'; // Senha de acesso
        let participantes = JSON.parse(localStorage.getItem('participantes')) || [];
        let historico = JSON.parse(localStorage.getItem('historico')) || [];

        function login() {
            const passwordInput = document.getElementById('password').value;
            if (passwordInput === senhaCorreta) {
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainPage').classList.remove('hidden');
                carregarHistorico();
                carregarParticipantes();
            } else {
                document.getElementById('error').style.display = 'block';
            }
        }

        function adicionarNome() {
            const nome = document.getElementById('nome').value.trim();
            if (nome && !participantes.includes(nome)) {
                participantes.push(nome);
                localStorage.setItem('participantes', JSON.stringify(participantes));
                alert(`${nome} foi adicionado ao sorteio!`);
                carregarParticipantes();
                fecharAdicionarParticipante(); // Fecha a aba flutuante
            }
        }

        function sortear() {
            const dataAtual = new Date();
            const ganhadoresRecentes = historico.filter(ganhador => {
                const dataGanhou = new Date(ganhador.data);
                return (dataAtual - dataGanhou) / (1000 * 3600 * 24) <= 2;
            });

            const participantesDisponiveis = participantes.filter(nome => {
                return !ganhadoresRecentes.some(ganhador => ganhador.nome === nome);
            });

            if (participantesDisponiveis.length === 0) {
                alert('Nenhum participante disponível para sorteio!');
                return;
            }

            const ganhador = participantesDisponiveis[Math.floor(Math.random() * participantesDisponiveis.length)];
            document.getElementById('ganhador').textContent = ganhador;

            historico.push({ nome: ganhador, data: new Date() });
            localStorage.setItem('historico', JSON.stringify(historico));
            carregarHistorico();
        }

        function carregarParticipantes() {
            const participantesList = document.getElementById('participantesList');
            participantesList.innerHTML = '';
            if (participantes.length > 0) {
                participantes.forEach(nome => {
                    const li = document.createElement('li');
                    li.textContent = nome;
                    participantesList.appendChild(li);
                });
            } else {
                participantesList.innerHTML = '<li>Sem participantes no sorteio.</li>';
            }
        }

        function carregarHistorico() {
            const historicoUl = document.getElementById('historico');
            historicoUl.innerHTML = '';
            if (historico.length > 0) {
                historico.forEach(ganhador => {
                    const li = document.createElement('li');
                    li.textContent = `${ganhador.nome} - ${new Date(ganhador.data).toLocaleDateString()}`;
                    historicoUl.appendChild(li);
                });
            } else {
                historicoUl.innerHTML = '<li>Sem histórico de ganhadores.</li>';
            }
        }

        function mostrarAdicionarParticipante() {
            document.getElementById('adicionarParticipanteModal').style.display = 'block';
        }

        function fecharAdicionarParticipante() {
            document.getElementById('adicionarParticipanteModal').style.display = 'none';
        }

        function limparHistorico() {
            document.getElementById('confirmarLimpezaModal').style.display = 'block';
        }

        function fecharConfirmarLimpeza() {
            document.getElementById('confirmarLimpezaModal').style.display = 'none';
        }

        function confirmarLimpeza() {
            const senhaInput = document.getElementById('senhaLimpeza').value;
            if (senhaInput === senhaCorreta) {
                historico = [];
                localStorage.setItem('historico', JSON.stringify(historico));
                carregarHistorico();
                alert('Histórico limpo com sucesso!');
                fecharConfirmarLimpeza();
            } else {
                alert('Senha incorreta!');
            }
        }
    </script>
</body>
</html>
